trigger:
  branches:
    include:
    - master
  paths:
    include:
    - ml/experiments

variables:
- group: mlops-dev
- name: infraArmTemplateParameterFile
  value: ml/infra/parameters/dev.json
- name: infraArmTemplate
  value: ml/infra/deploy.json

steps:
- task: AzureResourceManagerTemplateDeployment@3
  inputs:
    overrideParameters: -tenantId $(tenantId)
    deploymentScope: 'Resource Group'
    azureResourceManagerConnection: 'azrm'
    subscriptionId: $(subscriptionId)
    action: 'Create Or Update Resource Group'
    resourceGroupName: 'dp100'
    location: 'East US'
    templateLocation: 'Linked artifact'
    csmFile: $(infraArmTemplateParameterFile)
    csmParametersFile: $(infraArmTemplate)
    deploymentMode: 'Incremental'